<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PayPal Checkout Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label {
            display: block;
            margin-top: 8px;
        }
        input {
            width: 300px;
            padding: 5px;
            margin-top: 4px;
        }
        button {
            margin-top: 12px;
            padding: 8px 12px;
            background-color: #0070ba;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Configure PayPal Button</h1>
<p>Use the fields below to configure the PayPal JS SDK. Provide your client ID (e.g., sandbox or live ID) and optionally set a locale, buyer-country (only for sandbox testing) and enable-funding parameters (comma‑separated).</p>
<form id="configForm" onsubmit="loadPayPalButton(); return false;">
    <label for="clientId">Client ID</label>
    <input type="text" id="clientId" name="clientId" placeholder="Enter your PayPal client ID" required>

    <label for="locale">Locale (optional)</label>
    <input type="text" id="locale" name="locale" placeholder="e.g., en_US">

    <label for="buyerCountry">Buyer Country (sandbox only)</label>
    <input type="text" id="buyerCountry" name="buyerCountry" placeholder="e.g., US">

    <label for="enableFunding">Enable Funding (comma‑separated, optional)</label>
    <input type="text" id="enableFunding" name="enableFunding" placeholder="e.g., venmo,paylater">

    <button type="submit">Load PayPal Buttons</button>
</form>
<div id="paypal-button-container" style="margin-top:20px;"></div>
<script>
function loadPayPalButton() {
    const clientId = document.getElementById('clientId').value.trim();
    const locale = document.getElementById('locale').value.trim();
    const buyerCountry = document.getElementById('buyerCountry').value.trim();
    const enableFunding = document.getElementById('enableFunding').value.trim();

    // Remove existing PayPal script if loaded
    const existingScript = document.querySelector('script[src*="paypal.com/sdk/js"]');
    if (existingScript) {
        existingScript.remove();
    }

    // Build the PayPal SDK URL
    let sdkUrl = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(clientId)}&currency=USD`;
    if (locale) sdkUrl += `&locale=${encodeURIComponent(locale)}`;
    if (buyerCountry) sdkUrl += `&buyer-country=${encodeURIComponent(buyerCountry)}`;
    if (enableFunding) sdkUrl += `&enable-funding=${encodeURIComponent(enableFunding)}`;

    // Create and append the new script
    const script = document.createElement('script');
    script.src = sdkUrl;
    script.onload = () => {
        // Clear any existing buttons
        const container = document.getElementById('paypal-button-container');
        container.innerHTML = '';

        paypal.Buttons({
            createOrder: () => {
                return fetch('/api/orders', { method: 'POST' })
                    .then(res => res.json())
                    .then(order => order.orderID);
            },
            onApprove: data => {
                return fetch(`/api/orders/${data.orderID}/capture`, { method: 'POST' })
                    .then(res => res.json())
                    .then(details => {
                        alert('Transaction completed');
                    });
            }
        }).render('#paypal-button-container');
    };
    document.head.appendChild(script);
}
</script>
</body>
</html>
